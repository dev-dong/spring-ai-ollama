<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ€ AI Code Analyzer - Cute Edition</title>

    <!-- Marked.js - ë§ˆí¬ë‹¤ìš´ íŒŒì‹± -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- Highlight.js - ì½”ë“œ í•˜ì´ë¼ì´íŒ… -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-light.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/java.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>

    <style>
        :root{
            --bg-gradient-1: #FFE5F1;
            --bg-gradient-2: #FFF4E3;
            --bg-gradient-3: #E8F5FF;

            --card-bg: #FFFFFF;
            --card-shadow: rgba(255, 182, 218, 0.3);
            --card-border: rgba(255, 182, 218, 0.4);

            --primary-pink: #FF6B9D;
            --primary-purple: #C084FC;
            --primary-mint: #86EFAC;
            --primary-yellow: #FDE047;
            --primary-blue: #60A5FA;

            --text-main: #4A4A4A;
            --text-light: #8B8B8B;
            --text-dark: #2D2D2D;

            --success: #10B981;
            --error: #EF4444;

            --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            --sans: 'Segoe UI', 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body{
            font-family: var(--sans);
            color: var(--text-main);
            min-height: 100vh;
            padding: 40px 20px;
            background:
                    radial-gradient(circle at 20% 20%, rgba(255, 182, 218, 0.25), transparent 50%),
                    radial-gradient(circle at 80% 80%, rgba(192, 132, 252, 0.2), transparent 50%),
                    radial-gradient(circle at 50% 50%, rgba(134, 239, 172, 0.15), transparent 70%),
                    linear-gradient(135deg, var(--bg-gradient-1) 0%, var(--bg-gradient-2) 50%, var(--bg-gradient-3) 100%);
            background-attachment: fixed;
        }

        /* ë– ë‹¤ë‹ˆëŠ” ë³„ ì• ë‹ˆë©”ì´ì…˜ */
        body::before,
        body::after {
            content: 'âœ¨';
            position: fixed;
            font-size: 24px;
            opacity: 0.6;
            animation: float 6s ease-in-out infinite;
            pointer-events: none;
        }

        body::before {
            top: 10%;
            left: 15%;
            animation-delay: 0s;
        }

        body::after {
            top: 70%;
            right: 10%;
            animation-delay: 3s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        .container{
            max-width: 900px;
            margin: 0 auto;
            border-radius: 30px;
            background: var(--card-bg);
            border: 3px solid var(--card-border);
            box-shadow:
                    0 20px 60px var(--card-shadow),
                    0 0 0 1px rgba(255, 255, 255, 0.9) inset;
            padding: 45px 40px;
            position: relative;
            overflow: hidden;
            animation: slideIn 0.6s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* ê·€ì—¬ìš´ ë°°ê²½ ì¥ì‹ */
        .container::before {
            content: 'ğŸŒ¸';
            position: absolute;
            top: 20px;
            right: 30px;
            font-size: 48px;
            opacity: 0.3;
            animation: wiggle 3s ease-in-out infinite;
        }

        .container::after {
            content: 'ğŸ’–';
            position: absolute;
            bottom: 20px;
            left: 30px;
            font-size: 36px;
            opacity: 0.3;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes wiggle {
            0%, 100% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        h1{
            text-align: center;
            letter-spacing: -0.02em;
            font-size: 36px;
            margin-bottom: 8px;
            line-height: 1.2;
            background: linear-gradient(135deg, var(--primary-pink), var(--primary-purple), var(--primary-mint));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 900;
            text-shadow: 0 2px 10px rgba(255, 107, 157, 0.2);
            animation: rainbow 3s ease-in-out infinite;
        }

        @keyframes rainbow {
            0%, 100% { filter: hue-rotate(0deg); }
            50% { filter: hue-rotate(20deg); }
        }

        .subtitle{
            text-align: center;
            color: var(--text-light);
            margin-bottom: 35px;
            font-size: 14px;
            font-weight: 600;
        }

        .upload-area{
            border: 3px dashed var(--primary-pink);
            background: linear-gradient(135deg,
            rgba(255, 107, 157, 0.05),
            rgba(192, 132, 252, 0.05));
            border-radius: 24px;
            padding: 35px 25px;
            text-align: center;
            margin-bottom: 20px;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .upload-area::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                    45deg,
                    transparent 30%,
                    rgba(255, 255, 255, 0.3) 50%,
                    transparent 70%
            );
            transform: rotate(45deg);
            transition: all 0.6s;
        }

        .upload-area:hover::before {
            left: 100%;
        }

        .upload-area p{
            color: var(--text-main);
            font-size: 15px;
            font-weight: 600;
            position: relative;
            z-index: 1;
        }

        .upload-area:hover{
            transform: translateY(-5px) scale(1.02);
            border-color: var(--primary-purple);
            background: linear-gradient(135deg,
            rgba(255, 107, 157, 0.1),
            rgba(192, 132, 252, 0.1));
            box-shadow:
                    0 10px 30px rgba(255, 107, 157, 0.3),
                    0 0 20px rgba(192, 132, 252, 0.2);
        }

        .upload-area:active {
            transform: translateY(-2px) scale(0.98);
        }

        textarea{
            width: 100%;
            min-height: 140px;
            padding: 18px 20px;
            border-radius: 20px;
            border: 2px solid var(--card-border);
            background: linear-gradient(135deg, #FFFFFF, #FEFAFF);
            color: var(--text-main);
            outline: none;
            font-size: 15px;
            line-height: 1.7;
            resize: vertical;
            transition: all 0.3s ease;
            font-family: var(--sans);
        }

        textarea::placeholder{
            color: var(--text-light);
        }

        textarea:focus{
            border-color: var(--primary-pink);
            box-shadow:
                    0 0 0 4px rgba(255, 107, 157, 0.15),
                    0 8px 25px rgba(255, 107, 157, 0.2);
            background: #FFFFFF;
            transform: translateY(-2px);
        }

        button{
            width: 100%;
            margin-top: 18px;
            padding: 16px 20px;
            border: 0;
            border-radius: 20px;
            color: #FFFFFF;
            font-weight: 800;
            font-size: 16px;
            letter-spacing: 0.5px;
            cursor: pointer;
            background: linear-gradient(135deg, var(--primary-pink), var(--primary-purple));
            box-shadow:
                    0 10px 30px rgba(255, 107, 157, 0.4),
                    0 0 20px rgba(192, 132, 252, 0.3);
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            position: relative;
            overflow: hidden;
        }

        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        button:hover::before {
            width: 300px;
            height: 300px;
        }

        button:hover:not(:disabled){
            transform: translateY(-3px) scale(1.02);
            box-shadow:
                    0 15px 40px rgba(255, 107, 157, 0.5),
                    0 0 30px rgba(192, 132, 252, 0.4);
        }

        button:active:not(:disabled){
            transform: translateY(0px) scale(0.98);
        }

        button:disabled{
            opacity: 0.6;
            cursor: not-allowed;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .file-list{
            display: block;
            margin-top: 15px;
            padding: 20px;
            border-radius: 20px;
            border: 2px solid var(--card-border);
            background: linear-gradient(135deg,
            rgba(255, 107, 157, 0.03),
            rgba(134, 239, 172, 0.03));
        }

        .file-list strong{
            display: block;
            margin-bottom: 12px;
            color: var(--primary-pink);
            font-size: 13px;
            font-weight: 800;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .file-item{
            padding: 14px 18px;
            margin: 10px 0;
            border-radius: 16px;
            border: 2px solid rgba(255, 107, 157, 0.2);
            background: #FFFFFF;
            color: var(--text-main);
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            transition: all 0.3s ease;
            animation: slideInRight 0.4s ease-out backwards;
        }

        .file-item:nth-child(1) { animation-delay: 0.1s; }
        .file-item:nth-child(2) { animation-delay: 0.2s; }
        .file-item:nth-child(3) { animation-delay: 0.3s; }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .file-item:hover {
            transform: translateX(5px);
            border-color: var(--primary-purple);
            box-shadow: 0 5px 15px rgba(192, 132, 252, 0.2);
        }

        .file-item span{
            color: var(--text-light);
            font-size: 13px;
        }

        .response-area{
            margin-top: 25px;
            padding: 25px;
            border-radius: 20px;
            border: 2px solid var(--card-border);
            background: linear-gradient(135deg, #FFFFFF, #FFFBFE);
            min-height: 150px;
            max-height: 650px;
            overflow-y: auto;
            white-space: normal;
            word-wrap: break-word;
            line-height: 1.85;
            font-size: 15px;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .streaming{
            border-left: 5px solid var(--primary-pink);
            box-shadow:
                    inset 0 0 0 1px rgba(255, 107, 157, 0.2),
                    0 0 20px rgba(255, 107, 157, 0.3);
            animation: streamPulse 1.5s ease-in-out infinite;
        }

        @keyframes streamPulse{
            0%, 100% {
                border-left-color: var(--primary-pink);
                box-shadow:
                        inset 0 0 0 1px rgba(255, 107, 157, 0.2),
                        0 0 20px rgba(255, 107, 157, 0.3);
            }
            50% {
                border-left-color: var(--primary-purple);
                box-shadow:
                        inset 0 0 0 1px rgba(192, 132, 252, 0.2),
                        0 0 20px rgba(192, 132, 252, 0.3);
            }
        }

        .status{
            text-align: center;
            margin-top: 15px;
            color: var(--text-light);
            font-size: 13px;
            font-weight: 700;
        }

        .typing-cursor{
            display: inline-block;
            width: 12px;
            height: 18px;
            border-radius: 4px;
            background: linear-gradient(135deg, var(--primary-pink), var(--primary-purple));
            vertical-align: baseline;
            animation: blink 1s infinite, bounce 0.5s ease-in-out infinite alternate;
        }

        @keyframes blink{
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-3px); }
        }

        /* ---------- ë§ˆí¬ë‹¤ìš´ ìŠ¤íƒ€ì¼ë§ ---------- */

        .response-area h1,
        .response-area h2,
        .response-area h3,
        .response-area h4{
            margin-top: 1.8em;
            margin-bottom: 0.8em;
            line-height: 1.3;
            letter-spacing: -0.01em;
            color: var(--text-dark);
        }

        .response-area h1{
            font-size: 1.9em;
            padding-bottom: 0.5em;
            border-bottom: 3px solid rgba(255, 107, 157, 0.3);
            background: linear-gradient(135deg, var(--primary-pink), var(--primary-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .response-area h2{
            font-size: 1.5em;
            padding-bottom: 0.4em;
            border-bottom: 2px solid rgba(192, 132, 252, 0.3);
            color: var(--primary-purple);
        }

        .response-area h3{
            font-size: 1.25em;
            color: var(--primary-pink);
        }

        .response-area h4{
            font-size: 1.1em;
            color: var(--text-main);
        }

        .response-area p{
            margin: 1em 0;
            color: var(--text-main);
        }

        .response-area strong{
            color: var(--text-dark);
            font-weight: 800;
        }

        .response-area a{
            color: var(--primary-pink);
            text-decoration: none;
            border-bottom: 2px solid rgba(255, 107, 157, 0.3);
            transition: all 0.2s ease;
        }

        .response-area a:hover{
            border-bottom-color: var(--primary-pink);
            background: rgba(255, 107, 157, 0.1);
        }

        .response-area ul,
        .response-area ol{
            margin: 1em 0 1.2em 1.5em;
            color: var(--text-main);
        }

        .response-area li{
            margin: 0.4em 0;
            padding-left: 0.3em;
        }

        .response-area ul li::marker {
            content: 'ğŸŒ¸ ';
        }

        .response-area code{
            font-family: var(--mono);
            font-size: 0.9em;
            padding: 3px 10px;
            border-radius: 12px;
            background: rgba(255, 107, 157, 0.1);
            border: 1px solid rgba(255, 107, 157, 0.2);
            color: var(--primary-pink);
            font-weight: 600;
        }

        .response-area pre{
            margin: 1.3em 0;
            padding: 20px;
            border-radius: 20px;
            overflow-x: auto;
            border: 2px solid rgba(192, 132, 252, 0.2);
            background: linear-gradient(135deg, #FAFAFA, #F8F9FF);
            box-shadow: 0 5px 20px rgba(192, 132, 252, 0.15);
        }

        .response-area pre code{
            background: transparent;
            border: 0;
            padding: 0;
            color: var(--text-main);
            line-height: 1.7;
            font-size: 14px;
            font-weight: normal;
        }

        .response-area blockquote{
            margin: 1.2em 0;
            padding: 15px 20px;
            border-radius: 16px;
            border-left: 5px solid var(--primary-mint);
            background: rgba(134, 239, 172, 0.1);
            color: var(--text-main);
        }

        .response-area hr{
            border: 0;
            height: 2px;
            margin: 1.5em 0;
            background: linear-gradient(
                    90deg,
                    transparent,
                    rgba(255, 107, 157, 0.4),
                    transparent
            );
        }

        .response-area table{
            width: 100%;
            border-collapse: collapse;
            margin: 1.4em 0;
            border-radius: 16px;
            overflow: hidden;
            border: 2px solid rgba(255, 107, 157, 0.2);
            background: #FFFFFF;
        }

        .response-area th,
        .response-area td{
            padding: 14px 16px;
            border-bottom: 1px solid rgba(255, 107, 157, 0.1);
            text-align: left;
            vertical-align: top;
        }

        .response-area th{
            background: linear-gradient(135deg,
            rgba(255, 107, 157, 0.15),
            rgba(192, 132, 252, 0.15));
            color: var(--text-dark);
            font-weight: 800;
        }

        .response-area tr:hover td{
            background: rgba(255, 107, 157, 0.05);
        }

        /* ìŠ¤í¬ë¡¤ë°” */
        .response-area::-webkit-scrollbar {
            width: 12px;
        }

        .response-area::-webkit-scrollbar-track {
            background: rgba(255, 107, 157, 0.1);
            border-radius: 12px;
        }

        .response-area::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, var(--primary-pink), var(--primary-purple));
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.5);
        }

        .response-area::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg,
            rgba(255, 107, 157, 0.9),
            rgba(192, 132, 252, 0.9));
        }

        /* ë“œë˜ê·¸ ì˜¤ë²„ íš¨ê³¼ */
        .upload-area.drag-over {
            border-color: var(--primary-mint);
            background: rgba(134, 239, 172, 0.2);
            transform: scale(1.05);
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            body {
                padding: 20px 15px;
            }

            .container {
                padding: 30px 25px;
                border-radius: 25px;
            }

            h1 {
                font-size: 28px;
            }

            .subtitle {
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <h1>ğŸ€ AI Code Analyzer</h1>
    <div class="subtitle">âœ¨ Powered by qwen3-coder - ê·€ì—¬ìš´ ì½”ë“œ ë¶„ì„ê¸° ğŸ’•</div>

    <div class="upload-area" onclick="document.getElementById('fileInput').click()">
        <p>ğŸ“ Java/Python íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš” ğŸŒ¸</p>
        <input type="file" id="fileInput" multiple accept=".java,.py,.js,.ts,.jsx,.tsx,.go,.rs,.cpp,.c,.txt,.md,.json,.xml,.yml,.sql" style="display: none;">
    </div>

    <div id="fileList" class="file-list" style="display: none;"></div>

    <textarea id="message" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš” ğŸ’¬ ì˜ˆ: 'ì´ ì½”ë“œì˜ ë²„ê·¸ë¥¼ ì°¾ì•„ì£¼ì„¸ìš”', 'ë¦¬íŒ©í† ë§ ì œì•ˆí•´ì£¼ì„¸ìš”' ğŸš€"></textarea>

    <button id="analyzeBtn">ë¶„ì„ ì‹œì‘ ğŸ‰</button>

    <div id="response" class="response-area" style="display: none;"></div>
    <div id="status" class="status"></div>
</div>

<script>
    // Marked.js ì„¤ì •
    marked.setOptions({
        breaks: true,
        gfm: true,
        headerIds: false,
        mangle: false,
        pedantic: false,
        sanitize: false,
        smartLists: true,
        smartypants: false,
        xhtml: false,
        highlight: function(code, lang) {
            if (lang && hljs.getLanguage(lang)) {
                try {
                    return hljs.highlight(code, { language: lang }).value;
                } catch (err) {
                    console.error('Highlight error:', err);
                }
            }
            return hljs.highlightAuto(code).value;
        }
    });

    const fileInput = document.getElementById('fileInput');
    const fileList = document.getElementById('fileList');
    const message = document.getElementById('message');
    const analyzeBtn = document.getElementById('analyzeBtn');
    const response = document.getElementById('response');
    const status = document.getElementById('status');

    let selectedFiles = [];
    let accumulatedText = '';
    let renderTimeout = null;

    // íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸
    fileInput.addEventListener('change', (e) => {
        selectedFiles = Array.from(e.target.files);
        displayFileList();
    });

    // íŒŒì¼ ëª©ë¡ í‘œì‹œ
    function displayFileList() {
        if (selectedFiles.length === 0) {
            fileList.style.display = 'none';
            return;
        }

        fileList.style.display = 'block';
        fileList.innerHTML = '<strong>ì„ íƒëœ íŒŒì¼ ğŸ’</strong>' +
            selectedFiles.map(f =>
                `<div class="file-item">ğŸ“„ ${f.name} <span>(${formatBytes(f.size)})</span></div>`
            ).join('');
    }

    // íŒŒì¼ í¬ê¸° í¬ë§·íŒ…
    function formatBytes(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
    }

    // ë§ˆí¬ë‹¤ìš´ ë Œë”ë§ (ë””ë°”ìš´ì‹±)
    function renderMarkdown() {
        if (renderTimeout) {
            clearTimeout(renderTimeout);
        }

        renderTimeout = setTimeout(() => {
            const rendered = marked.parse(accumulatedText);
            response.innerHTML = rendered;

            // ì½”ë“œ í•˜ì´ë¼ì´íŒ… ì ìš©
            response.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightElement(block);
            });

            // ìë™ ìŠ¤í¬ë¡¤ (ë§¨ ì•„ë˜ë¡œ)
            response.scrollTop = response.scrollHeight;
        }, 50);
    }

    // ìµœì¢… ë Œë”ë§ (ìŠ¤íŠ¸ë¦¬ë° ì™„ë£Œ í›„)
    function finalRender() {
        if (renderTimeout) {
            clearTimeout(renderTimeout);
        }

        const rendered = marked.parse(accumulatedText);
        response.innerHTML = rendered;

        // ì½”ë“œ í•˜ì´ë¼ì´íŒ… ì ìš©
        response.querySelectorAll('pre code').forEach((block) => {
            hljs.highlightElement(block);
        });

        // ìë™ ìŠ¤í¬ë¡¤ (ë§¨ ì•„ë˜ë¡œ)
        response.scrollTop = response.scrollHeight;
    }

    // ë¶„ì„ ë²„íŠ¼ í´ë¦­
    analyzeBtn.addEventListener('click', async () => {
        const messageText = message.value.trim();

        if (!messageText) {
            alert('ì§ˆë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”! ğŸ€');
            return;
        }

        // ì´ˆê¸°í™”
        accumulatedText = '';
        const hasFiles = selectedFiles.length > 0;

        // UI ì—…ë°ì´íŠ¸
        analyzeBtn.disabled = true;
        response.style.display = 'block';
        response.className = 'response-area streaming';
        response.innerHTML = '<span class="typing-cursor"></span>';
        status.textContent = 'ğŸ”„ AIê°€ ì—´ì‹¬íˆ ë¶„ì„ ì¤‘ì´ì—ìš”... ğŸ’•';

        try {
            if (hasFiles) {
                await streamWithFiles(messageText);
            } else {
                await streamChat(messageText);
            }

            response.className = 'response-area';
            status.textContent = 'âœ… ì™„ë£Œ! ğŸ‰';

        } catch (error) {
            response.className = 'response-area';
            response.innerHTML = `<div style="color: #EF4444; padding: 20px; background: rgba(239, 68, 68, 0.1); border-radius: 16px; border: 2px solid rgba(239, 68, 68, 0.3);">
                <strong>âŒ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš” ğŸ˜¢</strong><br>
                ${error.message}
            </div>`;
            status.textContent = 'âŒ ì—ëŸ¬ ë°œìƒ';
        } finally {
            analyzeBtn.disabled = false;
        }
    });

    // ì¼ë°˜ ì±„íŒ… ìŠ¤íŠ¸ë¦¬ë°
    async function streamChat(messageText) {
        const res = await fetch('http://localhost:8080/api/chat/stream', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ message: messageText })
        });

        if (!res.ok) {
            throw new Error(`HTTP ${res.status}: ${res.statusText}`);
        }

        await processStream(res.body);
    }

    // íŒŒì¼ ì²¨ë¶€ ìŠ¤íŠ¸ë¦¬ë°
    async function streamWithFiles(messageText) {
        const formData = new FormData();
        formData.append('message', messageText);
        selectedFiles.forEach(file => {
            formData.append('files', file);
        });

        const res = await fetch('http://localhost:8080/api/chat/stream/with-files', {
            method: 'POST',
            body: formData
        });

        if (!res.ok) {
            throw new Error(`HTTP ${res.status}: ${res.statusText}`);
        }

        await processStream(res.body);
    }

    // ìŠ¤íŠ¸ë¦¼ ì²˜ë¦¬
    async function processStream(stream) {
        const reader = stream.getReader();
        const decoder = new TextDecoder();

        sseBuffer = '';

        while (true) {
            const { done, value } = await reader.read();

            if (done) {
                flushSseBuffer(true);
                finalRender();
                break;
            }

            sseBuffer += decoder.decode(value, { stream: true });
            flushSseBuffer(false);
        }
    }

    function flushSseBuffer(flushAll) {
        const events = sseBuffer.split(/\r?\n\r?\n/);

        if (!flushAll) {
            sseBuffer = events.pop();
        } else {
            sseBuffer = '';
        }

        for (const evt of events) {
            const lines = evt.split(/\r?\n/);

            const dataLines = lines
                .filter(l => l.startsWith('data:'))
                .map(l => l.substring(5).replace(/^ /, ''));

            if (dataLines.length === 0) continue;

            const data = dataLines.join('\n');
            accumulatedText += data;

            renderMarkdown();
        }
    }

    // Enter í‚¤ë¡œ ì „ì†¡ (Shift+EnterëŠ” ì¤„ë°”ê¿ˆ)
    message.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            analyzeBtn.click();
        }
    });

    // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì§€ì›
    const uploadArea = document.querySelector('.upload-area');

    uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('drag-over');
    });

    uploadArea.addEventListener('dragleave', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('drag-over');
    });

    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('drag-over');

        const files = Array.from(e.dataTransfer.files);
        const validFiles = files.filter(f => {
            const ext = f.name.toLowerCase();
            return ext.endsWith('.java') || ext.endsWith('.py') ||
                ext.endsWith('.js') || ext.endsWith('.ts') ||
                ext.endsWith('.jsx') || ext.endsWith('.tsx') ||
                ext.endsWith('.go') || ext.endsWith('.rs') ||
                ext.endsWith('.cpp') || ext.endsWith('.c') ||
                ext.endsWith('.txt') || ext.endsWith('.md') ||
                ext.endsWith('.json') || ext.endsWith('.xml') ||
                ext.endsWith('.yml') || ext.endsWith('.sql');
        });

        if (validFiles.length > 0) {
            selectedFiles = validFiles;
            displayFileList();
        } else {
            alert('ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤ ğŸ˜¢');
        }
    });
</script>
</body>
</html>